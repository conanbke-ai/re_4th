// ============================================================================
// Python ↔ Arduino 시리얼 통신 기본 예제
//  - PC(파이썬)에서 문자 '1' 또는 '0'을 시리얼로 보내면
//  - 아두이노가 그 값을 읽어서 RED LED(13번 핀)를 ON / OFF 한다.
//
//  통신 흐름 요약
//  1) 파이썬에서 COM 포트로 '1' 또는 '0' 한 글자를 전송
//  2) 아두이노의 시리얼 버퍼(Serial buffer)에 해당 바이트가 쌓임
//  3) loop()에서 Serial.available() > 0 이면 Serial.read()로 "1바이트"를 꺼냄
//  4) 꺼낸 값을 char로 받아 '1' / '0' 인지 비교 후, digitalWrite()로 LED 제어
// ============================================================================

// RED LED가 연결된 핀 번호를 상수 이름으로 정의
// - 여기서는 13번 핀에 빨간색 LED가 연결되어 있다고 가정
// - 이렇게 매직넘버(13)를 직접 쓰지 않고, 의미 있는 이름을 쓰면
//   코드 읽기가 훨씬 편해진다.
#define LED_RED 13

void setup() {
  // ------------------------------
  // 1. 시리얼 통신 초기화
  // ------------------------------
  // Serial.begin(9600)은 아두이노의 UART(시리얼 통신)를 9600 baud rate로 연다.
  //  - "9600"은 1초에 9600비트 전송 속도라는 의미
  //  - 파이썬 쪽에서도 serial.Serial(PORT, 9600)처럼 동일한 속도로 맞춰야 통신이 가능
  Serial.begin(9600);

  // ------------------------------
  // 2. LED 핀 모드 설정
  // ------------------------------
  // 13번 핀(LED_RED)을 출력 모드(OUTPUT)로 설정
  //  - OUTPUT : 해당 핀에서 HIGH(5V) 또는 LOW(0V)를 내보낼 수 있는 상태
  //  - 이 핀에 LED가 연결되어 있어야 ON/OFF 제어가 가능하다.
  pinMode(LED_RED, OUTPUT);
}

void loop() {
  // loop() 함수는 아두이노 전원이 켜져 있는 동안 계속 반복 실행된다.
  // 이 안에서 "시리얼로 데이터가 들어왔는지"를 계속 감시한다.

  // ------------------------------
  // 3. 시리얼 버퍼에 데이터가 있는지 확인
  // ------------------------------
  // Serial.available() :
  //  - PC → 아두이노 방향으로 들어온 데이터(바이트)가
  //    시리얼 수신 버퍼에 몇 개 쌓여 있는지 반환한다.
  //  - 0보다 크면, 즉 1개 이상 있으면 "읽을 데이터가 있다"는 의미
  if (Serial.available() > 0) {
    // ------------------------------
    // 4. 시리얼 버퍼에서 1바이트(문자 1개) 읽기
    // ------------------------------
    // Serial.read() :
    //  - 시리얼 수신 버퍼에서 "가장 먼저 도착해 있는 바이트 1개"를 꺼내서 반환한다.
    //  - 반환 타입은 int 이지만, 실제 내용은 1바이트(0~255) 값이다.
    //  - 여기서는 char 타입 변수 c에 담아서 "문자 1개"로 취급한다.
    //
    // 예) 파이썬에서 b"1"을 보내면
    //   - 시리얼 버퍼에 0x31(ASCII '1') 1바이트가 쌓이고,
    //   - Serial.read()가 이 바이트를 꺼내서 반환,
    //   - char c 에는 문자 '1'이 저장된다.
    char c = Serial.read();

    // ------------------------------
    // 5. 읽은 값에 따라 LED 제어
    // ------------------------------
    // c 가 문자 '1'이면 LED를 켠다. (반드시 작은 따옴표 사용)
    //  - digitalWrite(핀번호, HIGH) : 해당 핀을 HIGH(논리 1, 약 5V)로 설정
    //  - LED의 (+) 쪽이 이 핀에, (-) 쪽이 GND에 연결되어 있다면 불이 켜진다.
    if (c == '1') {
      digitalWrite(LED_RED, HIGH);   // LED ON

      // Serial.println() :
      //  - 아두이노 → PC 방향으로 문자열을 전송
      //  - 파이썬에서 arduino.readline() 등으로 읽어서 디버깅에 활용 가능
      Serial.println("LED ON from Arduino");
    } 
    // c 가 문자 '0'이면 LED를 끈다.
    //  - digitalWrite(핀번호, LOW) : 해당 핀을 LOW(논리 0, 0V)로 설정
    //  - LED에 흐르는 전류가 끊기므로 불이 꺼진다.
    else if (c == '0') {
      digitalWrite(LED_RED, LOW);    // LED OFF
      Serial.println("LED OFF from Arduino");
    }

    // 그 외 값 (예: 'a', '5', 기타 다른 문자들)은 아무 동작도 하지 않고 무시한다.
    // 필요하다면 else 블록을 추가해서 에러 로그를 찍거나, 다른 명령으로 쓸 수도 있다.
  }

  // loop() 끝 :
  // - 여기까지 실행되면 다시 loop() 처음으로 올라가서
  //   Serial.available()를 계속 검사하며 새로운 명령을 기다린다.
}
