/*
** ESP와 PC 통신 시, 속도 초기 설정 방법

1. (115200 상태에서) 시리얼 모니터로 AT → OK 확인

2. AT명령어로 속도 지정 : AT+UART_DEF=9600,8,1,0,0 → OK 확인
  (와이파이 모듈의 통신 속도를 9600으로 변경하는 명령어)

3. ESP-01 전원 리셋

4. 아두이노 코드에서 esp8266.begin(9600); 로 변경 후 업로드

5. 시리얼 모니터(9600)에서 AT → OK 나오면 성공
*/

#include <SoftwareSerial.h>

// D2 = Arduino RX(ESP TX), D3 = Arduino TX(ESP RX)
// 실질적으로 선 연결 ESP판의 TX 가 D2, ESP판의 RX가 D3 연결!!
SoftwareSerial myESP(2, 3);

void setup() {
  // Serial.begin(115200);
  // myESP.begin(115200);
  Serial.begin(9600);       // PC <-> 아두이노
  myESP.begin(9600);        // ESP-01 AT 펌웨어 속도를 9600으로 맞춘다고 가정

  Serial.println("=== Debug Bridge (9600 to ESP) ===");
  Serial.println("Type AT and press send (Both NL & CR).");
}

void loop() {
  // ===== ESP -> PC 브리지 =====
  while (myESP.available()) {
    char c = myESP.read();
    Serial.write(c);
  }

  // ===== PC -> ESP 브리지 =====
  while (Serial.available()) {
    char c = Serial.read();

    Serial.print("[PC->ESP] ");
    if (c == '\r') Serial.print("\\r");
    else if (c == '\n') Serial.print("\\n");
    else Serial.print(c);
    Serial.println();

    myESP.write(c);
  }
}

/*
 * ============================================================
 *  ESP8266(ESP-01) AT 명령어 테스트용 리스트
 *  - 시리얼 모니터 설정:
 *      Baud: 9600
 *      Line ending: Both NL & CR
 *  - 명령은 반드시 "대문자"로 입력 (AT, AT+GMR 등)
 * ============================================================
 *
 * ------------------------------------------------------------
 *  0. 기본 통신 / 디버그용
 * ------------------------------------------------------------
 *
 *  AT
 *    - 통신 확인용 기본 명령
 *    - 정상: "OK"
 *
 *  ATE0
 *    - 에코 끄기 (ESP가 내가 보낸 명령을 다시 출력하지 않게 함)
 *    - 로그를 깔끔하게 보고 싶을 때 사용
 *    - 정상: "OK"
 *
 *  ATE1
 *    - 에코 켜기 (기본값)
 *
 *
 * ------------------------------------------------------------
 *  1. 기본 정보 / 리셋 / UART 확인
 * ------------------------------------------------------------
 *
 *  AT+GMR
 *    - 펌웨어 버전 / SDK 버전 / 컴파일 시간 확인
 *    - 정상: 버전 정보 + "OK"
 *
 *  AT+RST
 *    - ESP 모듈 소프트 리셋
 *    - 정상:
 *        OK
 *        (이후 부트 로그)
 *        Ai-Thinker Technology Co. Ltd.
 *        
 *        ready
 *
 *  AT+UART?
 *    - 현재 UART 설정 확인
 *    - 예: "UART:9600,8,1,0,0"
 *
 *  AT+UART_DEF=9600,8,1,0,0
 *    - 기본 UART 속도를 9600으로 영구 설정 (리셋 후에도 유지)
 *    - 설정 바꾸고 나면, 다음부터는 9600으로 맞춰서 접속해야 함
 *
 *
 * ------------------------------------------------------------
 *  2. Wi-Fi 모드 관련
 * ------------------------------------------------------------
 *
 *  AT+CWMODE?
 *    - 현재 Wi-Fi 모드 확인
 *    - 1: Station (AP에 접속하는 클라이언트 모드)
 *    - 2: SoftAP (AP로 동작)
 *    - 3: Station + SoftAP
 *
 *  AT+CWMODE=1
 *    - Station 모드로 설정 (일반적으로 Flask 서버와 연동할 때 사용)
 *    - 필요 시 이후에 AT+RST로 재부팅
 *
 *
 * ------------------------------------------------------------
 *  3. Wi-Fi AP 스캔 / 접속
 * ------------------------------------------------------------
 *
 *  AT+CWLAP
 *    - 주변 Wi-Fi AP 목록 스캔
 *    - 한글 SSID는 깨져 보일 수 있음 (정상)
 *
 *  AT+CWJAP="SSID","PASSWORD"
 *    - 특정 AP에 접속
 *    - 예: AT+CWJAP="mywifi","mypassword"
 *    - 정상:
 *        WIFI CONNECTED
 *        WIFI GOT IP
 *        OK
 *
 *  AT+CWJAP?
 *    - 현재 접속 중인 AP 정보 확인
 *    - 접속 안 되어 있으면 "No AP" / "ERROR" 나올 수 있음
 *
 *
 * ------------------------------------------------------------
 *  4. IP / 네트워크 정보
 * ------------------------------------------------------------
 *
 *  AT+CIFSR
 *    - ESP의 IP / MAC 주소 확인
 *    - 예:
 *        +CIFSR:STAIP,"192.168.0.23"
 *        +CIFSR:STAMAC,"xx:xx:xx:xx:xx:xx"
 *        OK
 *    - STAIP가 ESP에 할당된 IP 주소
 *
 *
 * ------------------------------------------------------------
 *  5. TCP / HTTP 테스트 (Flask 등 서버와 연결)
 * ------------------------------------------------------------
 *
 *  AT+CIPMUX=0
 *    - 단일 연결 모드 (우리가 보통 쓰는 모드)
 *    - 0: 단일 연결, 1: 다중 연결
 *
 *  AT+CIPSTART="TCP","<SERVER_IP>",<PORT>
 *    - TCP 소켓 열기
 *    - 예: AT+CIPSTART="TCP","192.168.0.10",5000
 *    - 정상: "CONNECT" + "OK"
 *
 *  AT+CIPSEND=<길이>
 *    - 전송할 데이터의 바이트 길이를 먼저 알려줌
 *    - 정상: ">" 프롬프트가 나오면, 그 다음에 실제 데이터를 보냄
 *
 *    예) 간단한 HTTP GET 요청:
 *
 *      1) AT+CIPSEND=67   (예: 아래 요청 전체 길이에 맞춰 계산)
 *         → ">"
 *      2) GET / HTTP/1.1\r\n
 *         Host: 192.168.0.10:5000\r\n
 *         Connection: close\r\n
 *         \r\n
 *
 *    - 성공: "SEND OK" 이후, HTTP/1.1 200 OK ... 응답이 출력됨
 *
 *  AT+CIPCLOSE
 *    - TCP 연결 닫기
 *    - 정상: "CLOSED" / "CLOSE OK"
 *
 *
 * ------------------------------------------------------------
 *  6. 설정 초기화(조심해서 사용)
 * ------------------------------------------------------------
 *
 *  AT+RESTORE
 *    - 공장 초기화 (Wi-Fi 설정, UART_DEF, 기타 설정 모두 초기화)
 *    - 설정이 다 날아가기 때문에 정말 필요할 때만 사용
 *    - 정상: OK 후 리부팅 → 다시 "Ai-Thinker ... ready"
 *
 *
 * ------------------------------------------------------------
 *  7. 실전 테스트 추천 순서
 * ------------------------------------------------------------
 *
 *  1) AT             // 통신 확인
 *     ATE0           // 에코 끄기 (옵션)
 *  2) AT+GMR         // 펌웨어 버전 확인
 *  3) AT+CWMODE=1    // Station 모드 설정
 *  4) AT+CWJAP="SSID","PASSWORD"   // AP 접속
 *  5) AT+CIFSR       // IP 주소 확인
 *  6) AT+CIPMUX=0    // 단일 연결 모드
 *  7) AT+CIPSTART="TCP","<SERVER_IP>",<PORT>  // 서버 연결
 *  8) AT+CIPSEND=... + HTTP 요청 전송
 *  9) AT+CIPCLOSE    // 연결 종료
 *
 *  위 순서대로 하나씩 성공하는지 확인하면
 *  ESP-01 ↔ Wi-Fi ↔ Flask(또는 다른 서버)까지 전체 경로를 점검할 수 있음.
 *
 * ============================================================
 */
