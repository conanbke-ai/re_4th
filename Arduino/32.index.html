<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Arduino LED Control</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
      /* 기본 레이아웃 */
      body {
        margin: 0;
        padding: 0;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Noto Sans KR", sans-serif;
        background: #f5f5f5;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
      }

      .card {
        background: #ffffff;
        padding: 40px 60px;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        text-align: center;
        min-width: 320px;
      }

      h1 {
        font-size: 32px;
        margin-bottom: 30px;
      }

      .btn-group {
        display: inline-flex;
        gap: 16px;
        margin-bottom: 24px;
      }

      .btn {
        border: none;
        border-radius: 20px;
        padding: 10px 26px;
        font-size: 14px;
        font-weight: 600;
        color: #ffffff;
        cursor: pointer;
        transition: transform 0.1s ease, box-shadow 0.1s ease, opacity 0.2s;
      }

      .btn:active {
        transform: translateY(1px);
        box-shadow: none;
      }

      .btn-on {
        background: #1abc9c;
        box-shadow: 0 4px 10px rgba(26, 188, 156, 0.5);
      }

      .btn-off {
        background: #e74c3c;
        box-shadow: 0 4px 10px rgba(231, 76, 60, 0.5);
      }

      .status {
        font-size: 14px;
        color: #555;
      }

      .status strong {
        font-weight: 700;
      }

      .status-value.on {
        color: #1abc9c;
      }

      .status-value.off {
        color: #e74c3c;
      }

      .status-value.error {
        color: #c0392b;
      }
    </style>
  </head>
  <body>
    <div class="card">
      <h1>Arduino LED Control</h1>

      <div class="btn-group">
        <button class="btn btn-on" id="btnOn">LED ON</button>
        <button class="btn btn-off" id="btnOff">LED OFF</button>
      </div>

      <div class="status">
        Current:
        <strong id="statusValue" class="status-value off">off</strong>
      </div>
    </div>

    <script>
      // Flask 서버 주소 (필요하면 포트/호스트 수정)
      const API_URL = "/led";

      const btnOn = document.getElementById("btnOn");
      const btnOff = document.getElementById("btnOff");
      const statusValue = document.getElementById("statusValue");

      async function setLed(state) {
        try {
          // 버튼 연속 클릭 방지
          btnOn.disabled = true;
          btnOff.disabled = true;

          const response = await fetch(API_URL, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ state: state }), // { "state": "on" } / { "state": "off" }
          });

          let data = {};
          try {
            data = await response.json(); // JSON 파싱 시도
          } catch (e) {
            console.error("JSON parse error:", e);
          }

          // 응답 상태 / 바디를 콘솔에 출력해서 실제 무엇이 오는지 확인
          console.log("LED API response:", response.status, data);

          // 1) HTTP 에러 (400, 500 등) 인 경우
          if (!response.ok) {
            statusValue.textContent = data.error || `HTTP ${response.status}`;
            statusValue.className = "status-value error";
            return;
          }

          // 2) 서버가 ok:false 를 준 경우
          if (data.ok === false) {
            statusValue.textContent = data.error || "error";
            statusValue.className = "status-value error";
            return;
          }

          // 3) 정상 응답
          statusValue.textContent = data.state;
          statusValue.className =
            "status-value " + (data.state === "on" ? "on" : "off");
        } catch (err) {
          console.error("Request failed:", err);
          statusValue.textContent = "network error";
          statusValue.className = "status-value error";
        } finally {
          btnOn.disabled = false;
          btnOff.disabled = false;
        }
      }

      btnOn.addEventListener("click", () => setLed("on"));
      btnOff.addEventListener("click", () => setLed("off"));
    </script>
  </body>
</html>
